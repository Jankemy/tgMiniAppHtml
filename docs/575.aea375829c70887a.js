"use strict";(self.webpackChunkendless=self.webpackChunkendless||[]).push([[575],{1575:(J,f,u)=>{u.r(f),u.d(f,{SwipeModule:()=>H});var T=u(345),v=u(467),n=u(4438);let y=(()=>{class o{constructor(){this.CutCoinEvent=new n.bkB,this.TouchmoveCoordinatesEvent=new n.bkB}static#e=this.\u0275fac=function(t){return new(t||o)};static#t=this.\u0275prov=n.jDH({token:o,factory:o.\u0275fac,providedIn:"root"})}return o})(),B=(()=>{class o{constructor(e){this.eventService=e,this.cutCoinId=0,this.cutBoxPosition={},this.top=0,this.left=0,this.cutCoinSubscription={},this.imagePaths=["assets/cat-coin/cat-coin-1.png","assets/cat-coin/cat-coin-2.png","assets/cat-coin/cat-coin-3.png","assets/cat-coin/cat-coin-4.png"]}ngAfterViewInit(){let e=this,t=document.getElementById(`cutCoin-${e.cutCoinId}`),i=e.imagePaths[e.randomIntFromInterval(0,e.imagePaths.length-1)],r=e.randomIntFromInterval(0,359);t.style.backgroundImage=`url("${i}")`,t.style.transform=`rotate(${r}deg)`;let l=e.cutBoxPosition.left+e.cutBoxPosition.width-50;e.top=e.randomIntFromInterval(e.cutBoxPosition.top,e.cutBoxPosition.top+e.cutBoxPosition.height-50),e.left=e.randomIntFromInterval(e.cutBoxPosition.left,l),t.style.top=`${e.top}px`,t.style.left=`${e.left}px`,e.cutCoinSubscription=e.eventService.TouchmoveCoordinatesEvent.subscribe(a=>{e.checkTouchmove(a)})}ngOnDestroy(){this.cutCoinSubscription.unsubscribe()}checkTouchmove(e){let t=this;t.top<e.y&&t.top+50>e.y&&t.left<e.x&&t.left+50>e.x&&t.onHoverEnd()}onHoverEnd(){this.eventService.CutCoinEvent.emit(this.cutCoinId)}randomIntFromInterval(e,t){return Math.floor(Math.random()*(t-e+1)+e)}static#e=this.\u0275fac=function(t){return new(t||o)(n.rXU(y))};static#t=this.\u0275cmp=n.VBU({type:o,selectors:[["app-cut-coin"]],inputs:{cutCoinId:"cutCoinId",cutBoxPosition:"cutBoxPosition"},decls:1,vars:2,consts:[[1,"cut-coin",3,"id"]],template:function(t,i){1&t&&n.nrm(0,"div",0),2&t&&n.Mz_("id","cutCoin-",i.cutCoinId,"")},styles:[".cut-coin[_ngcontent-%COMP%]{width:50px;height:50px;border-radius:50%;border:1px solid black;background-repeat:no-repeat;background-position:center;background-size:cover;position:absolute}"]})}return o})();var C=u(8471),A=u(1396),b=u(7554);let O=(()=>{class o{constructor(e){this.api=e,this.promiseUserProfile=void 0}get isProfileExist(){return!!this.userProfile?.id}initProfileService(){let e=this;return e.refreshProfile().then(t=>(e.userProfile=t,e.userProfile))}refreshProfile(){return this.api.get("me").then(e=>e.data)}profile(){let e=this;return!e.promiseUserProfile&&!e.userProfile?.id&&(e.promiseUserProfile=this.refreshProfile()),e.promiseUserProfile??new Promise((t,i)=>{t(e.userProfile)})}static#e=this.\u0275fac=function(t){return new(t||o)(n.KVO(b.G))};static#t=this.\u0275prov=n.jDH({token:o,factory:o.\u0275fac,providedIn:"root"})}return o})();var k=u(3616);let U=(()=>{class o{constructor(e){this.api=e,this.maxEnergy=100,this.energyIncrementer=1,this.totalUserEnergy=0,this.energyInterval={};let t=this;t.energyInterval=setInterval(()=>{t.totalUserEnergy<t.maxEnergy&&(t.totalUserEnergy+=t.energyIncrementer,t.totalUserEnergy>t.maxEnergy&&(t.totalUserEnergy=t.maxEnergy))},1e3)}get availableUserEnergy(){return this.totalUserEnergy}get totalEnergy(){return this.totalUserEnergy/this.maxEnergy*100}ngOnDestroy(){clearInterval(this.energyInterval)}getEnergy(){return this.api.get("energy")}initEnergyService(){let e=this;return e.getEnergy().then(t=>{e.maxEnergy=t.data.maxEnergy,e.energyIncrementer=t.data.energyRechargingPerSec,e.totalUserEnergy=t.data.availableEnergy})}decrementEnergy(){this.totalUserEnergy>0&&(this.totalUserEnergy-=1)}static#e=this.\u0275fac=function(t){return new(t||o)(n.KVO(b.G))};static#t=this.\u0275prov=n.jDH({token:o,factory:o.\u0275fac,providedIn:"root"})}return o})();var F=u(3554),x=u(177);let R=(()=>{class o{get valuePersentage(){return`${this.value}%`}get widthPersentage(){return`${this.width}%`}constructor(e){this.cd=e,this.value=50,this.label="",this.width=50}ngOnInit(){}ngOnChanges(e){}static#e=this.\u0275fac=function(t){return new(t||o)(n.rXU(n.gRc))};static#t=this.\u0275cmp=n.VBU({type:o,selectors:[["app-progress-bar"]],inputs:{value:"value",label:"label",width:"width"},features:[n.OA$],decls:5,vars:5,consts:[[1,"progress-container"],[1,"prigress-label"],[1,"progress"],[1,"progress-bar"]],template:function(t,i){1&t&&(n.j41(0,"div",0)(1,"div",1),n.EFF(2),n.k0s(),n.j41(3,"div",2),n.nrm(4,"div",3),n.k0s()()),2&t&&(n.R7$(2),n.JRh(i.label),n.R7$(),n.xc7("width",i.widthPersentage),n.R7$(),n.xc7("width",i.valuePersentage))},styles:[".progress-container[_ngcontent-%COMP%]{height:32px;border:1px solid #7C6CFE;border-radius:17px;display:flex;align-items:center;justify-content:space-between}.progress-container[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{margin:3px}.progress[_ngcontent-%COMP%]{height:24px;border:1px solid #7C6CFE;border-radius:15px;overflow:hidden;background:transparent}.prigress-label[_ngcontent-%COMP%]{margin-left:15px!important;color:#7c6cfe}.progress-bar[_ngcontent-%COMP%]{background-color:#7c6cfe;background:linear-gradient(223.87deg,#ff24d3 -10.47%,#865ffe 47.28%,#36bdfd 109.84%);border-radius:15px;height:100%;transition:all 1s ease 0s}"]})}return o})();const $=["cutBox"];function D(o,Y){1&o&&(n.j41(0,"div"),n.nrm(1,"img",9),n.k0s())}function X(o,Y){1&o&&(n.j41(0,"div"),n.nrm(1,"img",10),n.k0s())}let w=(()=>{class o extends A.${constructor(e,t,i,r,s,l){super(),this.renderer=e,this.profileService=t,this.eventService=i,this.scoreService=r,this.energyService=s,this.boostsService=l,this.cometContext=null,this.cometTrail=[],this.BASE_RADIUS=4,this.MAX_TRAIL_LENGTH=150,this.BASE_COLOR=[127,81,232],this.TARGET_COLOR=[255,0,213],this.MAX_SPEED=30,this.TTL=150,this.componentMap=new Map,this.cutBoxPosition={top:0,left:0,width:0,height:0},this.componentIdCounter=0,this.energyInterval={},this.autoswipeCheckInterval={},this.boostsCheckInterval={},this.swipeSubscription={},this.isEnabledAutoswipe=!1}get swipeCounter(){return this.scoreService.totalScore}get energyValue(){return this.energyService.totalEnergy}get isX5Boost(){return this.boostsService.boostsList.find(t=>t.type===C.b.swipe_x5).isApplied}get isAutoswipe(){return this.boostsService.boostsList.find(t=>t.type===C.b.autoswipe).isApplied}ngOnInit(){let e=this;e.setLoading(!0);var t=document.getElementById("app-swipe");document.body.style.overflowY="hidden",document.body.style.marginTop="1px",document.body.style.marginBottom="1px",window.scrollTo(0,1),window.Telegram?.WebApp?.expand(),t.addEventListener("touchmove",i=>{e.touchmoveEvent(i)}),Promise.all([e.profileService.initProfileService(),e.scoreService.initScoreService(),e.energyService.initEnergyService(),e.boostsService.initBoostsService()]).finally(()=>{e.isAutoswipe&&(e.enableAutoswipe(),e.boostsCheckInterval=setInterval(()=>{e.boostsService.initBoostsService()},1e3)),e.setLoading(!1)})}ngAfterViewInit(){var e=this,t=e.cutBox.element.nativeElement.getBoundingClientRect();e.cutBoxPosition={left:t.left,top:e.cutBox.element.nativeElement.offsetTop,width:t.width,height:t.height};for(let i=0;i<10;i++)e.addNewCutCoinComponent();e.swipeSubscription=e.eventService.CutCoinEvent.subscribe(i=>{e.onCoinTouched(i)}),e.initCanvas(),e.isAutoswipe&&e.enableAutoswipe()}ngOnDestroy(){let e=this;e.swipeSubscription.unsubscribe(),clearInterval(e.energyInterval),clearInterval(e.autoswipeCheckInterval),clearInterval(e.boostsCheckInterval),e.isEnabledAutoswipe=!1,e.scoreService.saveSwipeBatch(e.energyService.availableUserEnergy)}initCanvas(){let e=this;e.cometCanvas=document.createElement("canvas"),e.cometContext=e.cometCanvas.getContext("2d"),e.cometContext&&(e.setupCanvas(),e.renderer.appendChild(document.body,e.cometCanvas),requestAnimationFrame(()=>e.animate()))}setupCanvas(){let e=this;e.cometCanvas.width=window.innerWidth,e.cometCanvas.height=window.innerHeight,e.cometCanvas.style.position="absolute",e.cometCanvas.style.left="0",e.cometCanvas.style.top="0",e.cometCanvas.style.pointerEvents="none",e.cometCanvas.style.zIndex="100000"}addPoint(e,t){this.cometTrail.push({x:e,y:t,createdAt:Date.now()})}animate(){let e=this;e.cometContext&&(e.cometContext.clearRect(0,0,e.cometCanvas.width,e.cometCanvas.height),e.cometTrail=e.cometTrail.filter(t=>Date.now()-t.createdAt<e.TTL),e.cometContext.filter="blur(3px) opacity(.75)",e.bezierTrail(),e.currentPos(),e.cometContext.filter="none",e.bezierTrail(),e.currentPos(),requestAnimationFrame(()=>e.animate()))}bezierTrail(){let e=this,t=[null,null,null,null];const i=e.cometContext,r=e.cometTrail.slice();for(var s=0;s<r.length;s++){let S=r[s];if(t[0]=t[1],t[1]=t[2],t[2]=S,!t[0])continue;let N=1-(Date.now()-S.createdAt)/e.TTL,K=e.BASE_RADIUS*N;var l=t[0],a=t[1],d=t[2],h=(l.x+a.x)/2,c=(l.y+a.y)/2,p=(a.x+d.x)/2,P=(a.y+d.y)/2;i.beginPath(),i.lineWidth=2*K,i.lineCap="round";let I=p-h,M=P-c,W=Math.min(Math.sqrt(I*I+M*M),e.MAX_SPEED)/e.MAX_SPEED;i.strokeStyle=this.getColor(W),i.moveTo(h,c),i.quadraticCurveTo(a.x,a.y,p,P),i.stroke()}}currentPos(){let e=this;const t=e.cometContext,i=e.cometTrail.slice();let s=0;if(i.length<1)return;if(i.length>1){let a=e.cometCanvas.width/2-i[i.length-2].x,d=e.cometCanvas.height/2-i[i.length-2].y;s=Math.min(Math.sqrt(a*a+d*d),e.MAX_SPEED)/e.MAX_SPEED}let l=Math.min(i.length>1?(Date.now()-i[i.length-2].createdAt)/1e3:1,1);t.beginPath(),t.fillStyle=e.getColor((1-l)*s),t.fill()}getColor(e){let t=this.BASE_COLOR.map((i,r)=>i+e*(this.TARGET_COLOR[r]-i));return`rgb(${t[0]}, ${t[1]}, ${t[2]})`}enableAutoswipe(){var e=this;return(0,v.A)(function*(){let t=e;if(t.isEnabledAutoswipe)return;t.isEnabledAutoswipe=!0;let i={x:t.cutBoxPosition.left,y:t.cutBoxPosition.top},r=0,s=t.componentMap.get(r).instance,l={x:s.left+25,y:s.top+25};for(;t.isEnabledAutoswipe&&t.isAutoswipe;){if(yield e.sleepTime(100),t.energyValue<=0)continue;yield t.enableAutoswipeLine(i,l),i=l,r++;let a=t.componentMap.get(r);for(;!a;)r++,a=t.componentMap.get(r);s=a.instance,l={x:s.left+25,y:s.top+25}}clearInterval(t.boostsCheckInterval)})()}enableAutoswipeLine(e,t){var i=this;return(0,v.A)(function*(){let r=i,s=(e.y-t.y)/(e.x-t.x),l=e.y-s*e.x;if(Math.abs(e.x-t.x)>Math.abs(e.y-t.y))for(let c=e.x;e.x>t.x?c>t.x:c<t.x;e.x>t.x?c-=15:c+=15)yield r.sleepTime(1),r.emitCustomEvent({x:c,y:s*c+l});else for(let c=e.y;e.y>t.y?c>t.y:c<t.y;e.y>t.y?c-=15:c+=15)yield r.sleepTime(1),r.emitCustomEvent({x:(c-l)/s,y:c})})()}sleepTime(e){return(0,v.A)(function*(){return new Promise(t=>setTimeout(t,e))})()}onCoinTouched(e){let t=this;t.componentMap.get(e).destroy(),t.componentMap.delete(e),t.energyService.decrementEnergy(),t.scoreService.incrementScore(t.energyService.availableUserEnergy);for(let r=0;r<1;r++)t.addNewCutCoinComponent()}touchmoveEvent(e){e.preventDefault(),this.emitCustomEvent({x:e.changedTouches[0].clientX,y:e.changedTouches[0].clientY+1})}emitCustomEvent(e){let t=this;t.energyValue>0&&t.eventService.TouchmoveCoordinatesEvent.emit(e),t.addPoint(e.x,e.y)}addNewCutCoinComponent(){let e=this,t=e.cutBox.createComponent(B),i=e.componentIdCounter++;e.componentMap.set(i,t),t.instance.cutCoinId=i,t.instance.cutBoxPosition=e.cutBoxPosition,e.renderer.appendChild(e.cutBox.element.nativeElement,t.location.nativeElement)}static#e=this.\u0275fac=function(t){return new(t||o)(n.rXU(n.sFG),n.rXU(O),n.rXU(y),n.rXU(k.o),n.rXU(U),n.rXU(F.Y))};static#t=this.\u0275cmp=n.VBU({type:o,selectors:[["app-swipe"]],viewQuery:function(t,i){if(1&t&&n.GBs($,5,n.c1b),2&t){let r;n.mGM(r=n.lsd())&&(i.cutBox=r.first)}},features:[n.Vt3],decls:12,vars:6,consts:[["cutBox",""],["id","app-swipe",1,"swipe-box"],["id","totalHeader"],["id","swipeCounter"],["id","options"],[4,"ngIf"],["id","cutBox"],["id","energy"],[3,"label","width","value"],["src","assets/boost-icons/X3-boost.svg"],["src","assets/boost-icons/autoswipe-boost.svg"]],template:function(t,i){1&t&&(n.j41(0,"div",1)(1,"div",2),n.EFF(2,"Total swipes"),n.k0s(),n.j41(3,"div",3),n.EFF(4),n.k0s(),n.j41(5,"div",4),n.DNE(6,D,2,0,"div",5)(7,X,2,0,"div",5),n.k0s(),n.nrm(8,"div",6,0),n.j41(10,"div",7),n.nrm(11,"app-progress-bar",8),n.k0s()()),2&t&&(n.R7$(4),n.JRh(i.swipeCounter),n.R7$(2),n.Y8G("ngIf",i.isX5Boost),n.R7$(),n.Y8G("ngIf",i.isAutoswipe),n.R7$(4),n.Y8G("label","Energy")("width","65")("value",i.energyValue))},dependencies:[x.bT,R],styles:[".swipe-box[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:space-between;height:-webkit-fill-available;width:100%;background-color:#000}.gif-box[_ngcontent-%COMP%]{width:80%;margin-left:auto;margin-right:auto}#cutBox[_ngcontent-%COMP%]{height:-webkit-fill-available}#swipeCounter[_ngcontent-%COMP%]{font-size:48px;background:linear-gradient(223.87deg,#ff24d3 -10.47%,#865ffe 47.28%,#36bdfd 109.84%);-webkit-background-clip:text;background-clip:text;-webkit-text-fill-color:transparent}#totalHeader[_ngcontent-%COMP%]{font-size:17px;padding:10px;color:#fff}#energy[_ngcontent-%COMP%]{padding:20px}#options[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center}#options[_ngcontent-%COMP%] > div[_ngcontent-%COMP%] > img[_ngcontent-%COMP%]{width:30px;margin:5px}"]})}return o})();var G=u(3887),E=u(4255);const V=[{path:"",component:w}];let z=(()=>{class o{static#e=this.\u0275fac=function(t){return new(t||o)};static#t=this.\u0275mod=n.$C({type:o});static#n=this.\u0275inj=n.G2t({imports:[E.iI.forChild(V),E.iI]})}return o})(),H=(()=>{class o{static#e=this.\u0275fac=function(t){return new(t||o)};static#t=this.\u0275mod=n.$C({type:o,bootstrap:[w]});static#n=this.\u0275inj=n.G2t({imports:[z,x.MD,T.Bb,G.G]})}return o})()}}]);