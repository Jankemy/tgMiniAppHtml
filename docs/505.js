"use strict";(self.webpackChunkendless=self.webpackChunkendless||[]).push([[505],{3505:(J,C,u)=>{u.r(C),u.d(C,{SwipeModule:()=>V});var M=u(345),g=u(467),n=u(4438);let f=(()=>{class i{constructor(){this.CutCoinEvent=new n.bkB,this.TouchmoveCoordinatesEvent=new n.bkB}static#t=this.\u0275fac=function(e){return new(e||i)};static#e=this.\u0275prov=n.jDH({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})(),T=(()=>{class i{constructor(t){this.eventService=t,this.cutCoinId=0,this.cutBoxPosition={},this.top=0,this.left=0,this.cutCoinSubscription={},this.imagePaths=["assets/cat-coin/cat-coin-1.png","assets/cat-coin/cat-coin-2.png","assets/cat-coin/cat-coin-3.png","assets/cat-coin/cat-coin-4.png"]}ngAfterViewInit(){let t=this,e=document.getElementById(`cutCoin-${t.cutCoinId}`),o=t.imagePaths[t.randomIntFromInterval(0,t.imagePaths.length-1)],s=t.randomIntFromInterval(0,359);e.style.backgroundImage=`url("${o}")`,e.style.transform=`rotate(${s}deg)`;let l=t.cutBoxPosition.left+t.cutBoxPosition.width-50;t.top=t.randomIntFromInterval(t.cutBoxPosition.top,t.cutBoxPosition.top+t.cutBoxPosition.height-50),t.left=t.randomIntFromInterval(t.cutBoxPosition.left,l),e.style.top=`${t.top}px`,e.style.left=`${t.left}px`,t.cutCoinSubscription=t.eventService.TouchmoveCoordinatesEvent.subscribe(a=>{t.checkTouchmove(a)})}ngOnDestroy(){this.cutCoinSubscription.unsubscribe()}checkTouchmove(t){let e=this;e.top<t.y&&e.top+50>t.y&&e.left<t.x&&e.left+50>t.x&&e.onHoverEnd()}onHoverEnd(){this.eventService.CutCoinEvent.emit(this.cutCoinId)}randomIntFromInterval(t,e){return Math.floor(Math.random()*(e-t+1)+t)}static#t=this.\u0275fac=function(e){return new(e||i)(n.rXU(f))};static#e=this.\u0275cmp=n.VBU({type:i,selectors:[["app-cut-coin"]],inputs:{cutCoinId:"cutCoinId",cutBoxPosition:"cutBoxPosition"},decls:1,vars:2,consts:[[1,"cut-coin",3,"id"]],template:function(e,o){1&e&&n.nrm(0,"div",0),2&e&&n.Mz_("id","cutCoin-",o.cutCoinId,"")},styles:[".cut-coin[_ngcontent-%COMP%]{width:50px;height:50px;border-radius:50%;border:1px solid black;background-repeat:no-repeat;background-position:center;background-size:cover;position:absolute}"]})}return i})();var y=u(8471),B=u(9084),A=u(79),O=u(3616),k=u(5286),F=u(3554),b=u(177);let R=(()=>{class i{get valuePersentage(){return`${this.value}%`}get widthPersentage(){return`${this.width}%`}constructor(t){this.cd=t,this.value=50,this.label="",this.width=50}ngOnInit(){}ngOnChanges(t){}static#t=this.\u0275fac=function(e){return new(e||i)(n.rXU(n.gRc))};static#e=this.\u0275cmp=n.VBU({type:i,selectors:[["app-progress-bar"]],inputs:{value:"value",label:"label",width:"width"},features:[n.OA$],decls:5,vars:5,consts:[[1,"progress-container"],[1,"prigress-label"],[1,"progress"],[1,"progress-bar"]],template:function(e,o){1&e&&(n.j41(0,"div",0)(1,"div",1),n.EFF(2),n.k0s(),n.j41(3,"div",2),n.nrm(4,"div",3),n.k0s()()),2&e&&(n.R7$(2),n.JRh(o.label),n.R7$(),n.xc7("width",o.widthPersentage),n.R7$(),n.xc7("width",o.valuePersentage))},styles:[".progress-container[_ngcontent-%COMP%]{height:32px;border:1px solid #7C6CFE;border-radius:17px;display:flex;align-items:center;justify-content:space-between}.progress-container[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{margin:3px}.progress[_ngcontent-%COMP%]{height:24px;border:1px solid #7C6CFE;border-radius:15px;overflow:hidden;background:transparent}.prigress-label[_ngcontent-%COMP%]{margin-left:15px!important;color:#7c6cfe}.progress-bar[_ngcontent-%COMP%]{background-color:#7c6cfe;background:linear-gradient(223.87deg,#ff24d3 -10.47%,#865ffe 47.28%,#36bdfd 109.84%);border-radius:15px;height:100%;transition:all 1s ease 0s}"]})}return i})();const $=["cutBox"];function D(i,H){1&i&&(n.j41(0,"div"),n.nrm(1,"img",9),n.k0s())}function L(i,H){1&i&&(n.j41(0,"div"),n.nrm(1,"img",10),n.k0s())}let w=(()=>{class i{constructor(t,e,o,s,r,l){this.renderer=t,this.profileService=e,this.eventService=o,this.scoreService=s,this.energyService=r,this.boostsService=l,this.cometContext=null,this.cometTrail=[],this.BASE_RADIUS=4,this.MAX_TRAIL_LENGTH=150,this.BASE_COLOR=[127,81,232],this.TARGET_COLOR=[255,0,213],this.MAX_SPEED=30,this.TTL=150,this.componentMap=new Map,this.cutBoxPosition={top:0,left:0,width:0,height:0},this.componentIdCounter=0,this.energyInterval={},this.autoswipeCheckInterval={},this.boostsCheckInterval={},this.swipeSubscription={},this.isEnabledAutoswipe=!1}get swipeCounter(){return this.scoreService.totalScore}get energyValue(){return this.energyService.totalEnergy}get isX5Boost(){return this.boostsService.boostsList.find(e=>e.type===y.b.swipe_x5).isApplied}get isAutoswipe(){return this.boostsService.boostsList.find(e=>e.type===y.b.autoswipe).isApplied}ngOnInit(){let t=this;t.setLoading(!0);var e=document.getElementById("app-swipe");document.body.style.overflowY="hidden",document.body.style.marginTop="1px",document.body.style.marginBottom="1px",window.scrollTo(0,1),window.Telegram?.WebApp?.expand(),e.addEventListener("touchmove",o=>{t.touchmoveEvent(o)}),t.profileService.initProfileService().then(o=>{Promise.all([t.scoreService.initScoreService(),t.energyService.initEnergyService(),t.boostsService.initBoostsService()]).finally(()=>{t.autoswipeCheckInterval=setInterval(()=>{t.isAutoswipe&&(t.enableAutoswipe(),clearInterval(t.autoswipeCheckInterval))},100),t.boostsCheckInterval=setInterval(()=>{t.boostsService.initBoostsService()},500),t.setLoading(!1)})})}ngAfterViewInit(){var t=this,e=t.cutBox.element.nativeElement.getBoundingClientRect();t.cutBoxPosition={left:e.left,top:t.cutBox.element.nativeElement.offsetTop,width:e.width,height:e.height};for(let o=0;o<10;o++)t.addNewCutCoinComponent();t.swipeSubscription=t.eventService.CutCoinEvent.subscribe(o=>{t.onCoinTouched(o)}),t.initCanvas(),t.isAutoswipe&&t.enableAutoswipe()}initCanvas(){let t=this;t.cometCanvas=document.createElement("canvas"),t.cometContext=t.cometCanvas.getContext("2d"),t.cometContext&&(t.setupCanvas(),t.renderer.appendChild(document.body,t.cometCanvas),requestAnimationFrame(()=>t.animate()))}setupCanvas(){let t=this;t.cometCanvas.width=window.innerWidth,t.cometCanvas.height=window.innerHeight,t.cometCanvas.style.position="absolute",t.cometCanvas.style.left="0",t.cometCanvas.style.top="0",t.cometCanvas.style.pointerEvents="none",t.cometCanvas.style.zIndex="100000"}addPoint(t,e){this.cometTrail.push({x:t,y:e,createdAt:Date.now()})}animate(){let t=this;t.cometContext&&(t.cometContext.clearRect(0,0,t.cometCanvas.width,t.cometCanvas.height),t.cometTrail=t.cometTrail.filter(e=>Date.now()-e.createdAt<t.TTL),t.cometContext.filter="blur(3px) opacity(.75)",t.bezierTrail(),t.currentPos(),t.cometContext.filter="none",t.bezierTrail(),t.currentPos(),requestAnimationFrame(()=>t.animate()))}bezierTrail(){let t=this,e=[null,null,null,null];const o=t.cometContext,s=t.cometTrail.slice();for(var r=0;r<s.length;r++){let P=s[r];if(e[0]=e[1],e[1]=e[2],e[2]=P,!e[0])continue;let Y=1-(Date.now()-P.createdAt)/t.TTL,N=t.BASE_RADIUS*Y;var l=e[0],a=e[1],p=e[2],h=(l.x+a.x)/2,c=(l.y+a.y)/2,d=(a.x+p.x)/2,S=(a.y+p.y)/2;o.beginPath(),o.lineWidth=2*N,o.lineCap="round";let E=d-h,I=S-c,W=Math.min(Math.sqrt(E*E+I*I),t.MAX_SPEED)/t.MAX_SPEED;o.strokeStyle=this.getColor(W),o.moveTo(h,c),o.quadraticCurveTo(a.x,a.y,d,S),o.stroke()}}currentPos(){let t=this;const e=t.cometContext,o=t.cometTrail.slice();let r=0;if(o.length<1)return;if(o.length>1){let a=t.cometCanvas.width/2-o[o.length-2].x,p=t.cometCanvas.height/2-o[o.length-2].y;r=Math.min(Math.sqrt(a*a+p*p),t.MAX_SPEED)/t.MAX_SPEED}let l=Math.min(o.length>1?(Date.now()-o[o.length-2].createdAt)/1e3:1,1);e.beginPath(),e.fillStyle=t.getColor((1-l)*r),e.fill()}getColor(t){let e=this.BASE_COLOR.map((o,s)=>o+t*(this.TARGET_COLOR[s]-o));return`rgb(${e[0]}, ${e[1]}, ${e[2]})`}enableAutoswipe(){var t=this;return(0,g.A)(function*(){let e=t;if(e.isEnabledAutoswipe)return;e.isEnabledAutoswipe=!0;let o={x:e.cutBoxPosition.left,y:e.cutBoxPosition.top},s=0,r=e.componentMap.get(s).instance,l={x:r.left+25,y:r.top+25};for(;e.isEnabledAutoswipe&&e.isAutoswipe;){if(yield t.sleepTime(100),e.energyValue<=0)continue;yield e.enableAutoswipeLine(o,l),o=l,s++;let a=e.componentMap.get(s);for(;!a;)s++,a=e.componentMap.get(s);r=a.instance,l={x:r.left+25,y:r.top+25}}})()}ngOnDestroy(){let t=this;t.swipeSubscription.unsubscribe(),clearInterval(t.energyInterval),clearInterval(t.autoswipeCheckInterval),clearInterval(t.boostsCheckInterval),t.isEnabledAutoswipe=!1,t.scoreService.saveSwipeBatch()}enableAutoswipeLine(t,e){var o=this;return(0,g.A)(function*(){let s=o,r=(t.y-e.y)/(t.x-e.x),l=t.y-r*t.x;if(Math.abs(t.x-e.x)>Math.abs(t.y-e.y))for(let c=t.x;t.x>e.x?c>e.x:c<e.x;t.x>e.x?c-=15:c+=15)yield s.sleepTime(1),s.emitCustomEvent({x:c,y:r*c+l});else for(let c=t.y;t.y>e.y?c>e.y:c<e.y;t.y>e.y?c-=15:c+=15)yield s.sleepTime(1),s.emitCustomEvent({x:(c-l)/r,y:c})})()}sleepTime(t){return(0,g.A)(function*(){return new Promise(e=>setTimeout(e,t))})()}onCoinTouched(t){let e=this;e.componentMap.get(t).destroy(),e.componentMap.delete(t),e.scoreService.incrementScore(),e.energyService.decrementEnergy();for(let s=0;s<1;s++)e.addNewCutCoinComponent()}touchmoveEvent(t){t.preventDefault(),this.emitCustomEvent({x:t.changedTouches[0].clientX,y:t.changedTouches[0].clientY+1})}emitCustomEvent(t){let e=this;e.energyValue>0&&e.eventService.TouchmoveCoordinatesEvent.emit(t),e.addPoint(t.x,t.y)}addNewCutCoinComponent(){let t=this,e=t.cutBox.createComponent(T),o=t.componentIdCounter++;t.componentMap.set(o,e),e.instance.cutCoinId=o,e.instance.cutBoxPosition=t.cutBoxPosition,t.renderer.appendChild(t.cutBox.element.nativeElement,e.location.nativeElement)}setLoading(t){B.s.setLoading(t)}static#t=this.\u0275fac=function(e){return new(e||i)(n.rXU(n.sFG),n.rXU(A.p),n.rXU(f),n.rXU(O.o),n.rXU(k.c),n.rXU(F.Y))};static#e=this.\u0275cmp=n.VBU({type:i,selectors:[["app-swipe"]],viewQuery:function(e,o){if(1&e&&n.GBs($,5,n.c1b),2&e){let s;n.mGM(s=n.lsd())&&(o.cutBox=s.first)}},decls:12,vars:6,consts:[["cutBox",""],["id","app-swipe",1,"swipe-box"],["id","totalHeader"],["id","swipeCounter"],["id","options"],[4,"ngIf"],["id","cutBox"],["id","energy"],[3,"label","width","value"],["src","assets/boost-icons/X3-boost.svg"],["src","assets/boost-icons/autoswipe-boost.svg"]],template:function(e,o){1&e&&(n.j41(0,"div",1)(1,"div",2),n.EFF(2,"Total swipes"),n.k0s(),n.j41(3,"div",3),n.EFF(4),n.k0s(),n.j41(5,"div",4),n.DNE(6,D,2,0,"div",5)(7,L,2,0,"div",5),n.k0s(),n.nrm(8,"div",6,0),n.j41(10,"div",7),n.nrm(11,"app-progress-bar",8),n.k0s()()),2&e&&(n.R7$(4),n.JRh(o.swipeCounter),n.R7$(2),n.Y8G("ngIf",o.isX5Boost),n.R7$(),n.Y8G("ngIf",o.isAutoswipe),n.R7$(4),n.Y8G("label","Energy")("width","65")("value",o.energyValue))},dependencies:[b.bT,R],styles:[".swipe-box[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:space-between;height:-webkit-fill-available;width:100%;background-color:#000}.gif-box[_ngcontent-%COMP%]{width:80%;margin-left:auto;margin-right:auto}#cutBox[_ngcontent-%COMP%]{height:-webkit-fill-available}#swipeCounter[_ngcontent-%COMP%]{font-size:48px;background:linear-gradient(223.87deg,#ff24d3 -10.47%,#865ffe 47.28%,#36bdfd 109.84%);-webkit-background-clip:text;background-clip:text;-webkit-text-fill-color:transparent}#totalHeader[_ngcontent-%COMP%]{font-size:17px;padding:10px;color:#fff}#energy[_ngcontent-%COMP%]{padding:20px}#options[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center}#options[_ngcontent-%COMP%] > div[_ngcontent-%COMP%] > img[_ngcontent-%COMP%]{width:30px;margin:5px}"]})}return i})();var G=u(3887),x=u(4255);const U=[{path:"",component:w}];let z=(()=>{class i{static#t=this.\u0275fac=function(e){return new(e||i)};static#e=this.\u0275mod=n.$C({type:i});static#n=this.\u0275inj=n.G2t({imports:[x.iI.forChild(U),x.iI]})}return i})(),V=(()=>{class i{static#t=this.\u0275fac=function(e){return new(e||i)};static#e=this.\u0275mod=n.$C({type:i,bootstrap:[w]});static#n=this.\u0275inj=n.G2t({imports:[z,b.MD,M.Bb,G.G]})}return i})()}}]);